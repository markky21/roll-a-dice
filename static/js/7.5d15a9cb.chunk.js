(this["webpackJsonproll-a-dice"]=this["webpackJsonproll-a-dice"]||[]).push([[7],{685:function(e,a,t){"use strict";t.d(a,"a",(function(){return d}));var n=t(686),r=t.n(n),c=t(689),o=t(54),i=t(23),l=t(33),s=t(278),m=r()({}),u=Object(o.a)(),d=Object(c.connectedRouterRedirect)({redirectPath:i.a.HOME_PATH,AuthenticatingComponent:s.a,wrapperDisplayName:"UserIsAuthenticated",authenticatedSelector:l.a.isAuthenticated,authenticatingSelector:l.a.authenticatingSelector,redirectAction:function(e){return function(a){u.push(e),a({type:"UNAUTHED_REDIRECT",payload:{message:"User is not authenticated."}})}}});Object(c.connectedRouterRedirect)({AuthenticatingComponent:s.a,wrapperDisplayName:"UserIsNotAuthenticated",allowRedirectBack:!1,authenticatedSelector:function(e){return e.firebase.auth.isEmpty},authenticatingSelector:function(e){var a=e.firebase,t=a.auth,n=a.isInitializing;return!t.isLoaded||n},redirectPath:function(e,a){return m.getRedirectQueryParam(a)||i.a.ROOMS_PATH},redirectAction:function(e){return function(a){u.push(e),a({type:"AUTHED_REDIRECT",payload:{message:"User is not authenticated."}})}}})},690:function(e,a,t){"use strict";t.d(a,"a",(function(){return r}));var n=t(0),r=t.n(n).a.lazy((function(){return t.e(6).then(t.bind(null,698))}))},691:function(e,a,t){"use strict";var n=t(0),r=t.n(n),c=t(20),o=t(654),i=t(774),l=t(775),s=t(771),m=t(772),u=t(773),d=t(674),p=t(103),b=t(282),g=t(609),E=t(657),f=t(662),v=t(605),h=t(11),O=t(276),y=Object(g.a)({image:{width:"100%",height:"15vh",backgroundPosition:"center",backgroundSize:"cover"}}),j=Object(v.a)(y);function x(e){var a,t=j(),n=Object(h.useSelector)(O.a.getFormCreateRoom);return r.a.createElement(E.a,{in:(null===n||void 0===n||null===(a=n.roomImage)||void 0===a?void 0:a.length)>8},(null===n||void 0===n?void 0:n.roomImage)&&r.a.createElement(f.a,{className:t.image,image:null===n||void 0===n?void 0:n.roomImage,title:"Room Image"}))}var S=Object(d.a)({form:"createRoom",validate:function(e){var a={};return[p.b.roomName.name,p.b.maxPlayers.name].forEach((function(t){e[t]||(a[t]="Required")})),e[p.b.diceType.name]&&e[p.b.diceType.name].length||(a[p.b.diceType.name]="Select at least one dice"),a}})((function(e){var a=e.handleSubmit,t=e.pristine,n=e.submitting,c=e.handleClose,o=e.invalid;return r.a.createElement("form",{onSubmit:a},r.a.createElement(x,null),r.a.createElement(s.a,{dividers:!0},r.a.createElement(b.c,p.b.roomName),r.a.createElement(b.c,p.b.roomImage),r.a.createElement(b.c,p.b.campaignTitle),r.a.createElement(b.c,p.b.description),r.a.createElement(b.c,p.b.gameMasterAvatar),r.a.createElement("div",{style:{width:"50%"}},r.a.createElement(b.c,p.b.maxPlayers)),r.a.createElement(b.a,p.b.diceType)),r.a.createElement(m.a,null,r.a.createElement(u.a,{type:"submit",color:"primary",disabled:o||t||n},"Submit"),r.a.createElement(u.a,{type:"button",onClick:c,color:"primary"},"Cancel")))}));function R(e){var a=e.open,t=e.onClose,n=e.onSubmit,s=e.initialValues,m=Object(c.a)(),u=Object(o.a)(m.breakpoints.down("xs"));return r.a.createElement(i.a,{fullScreen:u,open:a,onClose:t,"aria-labelledby":"responsive-dialog-title"},r.a.createElement(l.a,null,"Create new Room"),r.a.createElement(S,{handleClose:t,onSubmit:n,initialValues:s}))}t.d(a,"a",(function(){return R}))},776:function(e,a,t){"use strict";t.r(a);var n=t(22),r=t(81),c=t(692),o=t(685),i=Object(n.d)(Object(c.a)("EnhancedRoomList"),r.g,o.a),l=t(44),s=t(18),m=t(57),u=t(0),d=t.n(u),p=t(11),b=t(31),g=t(194),E=t(33),f=t(58),v=t(84),h=t(280),O=t(154),y=t(281),j=t(63),x=t(119),S=t(4),R=t(605),w=t(690),C=t(368),N=t(367),k=t(603),I=t(100),U=t(48),D=t(651),L=t(271),P=t(724),T=t.n(P),A=t(20),H=t(778),z=t(765),M=t(130),F=t(777),G=t(609),_=t(5),W=t(742),V=t(649),Y=t(103),B=t(598),J=t(655),q=t(679),K=t(656),Q=t(653),X=t(279);var Z=d.a.memo(Object(_.a)((function(e){return Object(G.a)({itemHeader:{width:"40%",paddingRight:e.spacing(2),boxSizing:"border-box"},itemContent:{width:"60%",boxSizing:"border-box"}})}))((function(e){var a=e.profile,t=e.log,n=e.classes,r=e.children,c=a||{},o=c.displayName,i=c.photoURL,l=c.avatarUrl;return d.a.createElement(B.a,{alignItems:"flex-start"},d.a.createElement("div",{className:n.itemHeader},d.a.createElement(J.a,null,d.a.createElement(q.a,{alt:o,src:l||i})),d.a.createElement(K.a,{primary:d.a.createElement(Q.a,{container:!0,direction:"row",justify:"space-between",alignItems:"flex-start"},d.a.createElement(M.a,{component:"span",variant:"body1"},o),d.a.createElement(M.a,{component:"span",variant:"caption",color:"textSecondary"},X.a.timeStampToDetailedTime(t.timestamp)))})),d.a.createElement("div",{className:n.itemContent},r))}))),$=t(146);var ee=d.a.memo(Object(_.a)((function(e){return Object(G.a)({})}))((function(e){var a,t=e.log,n=$.a.sortObjectWithDiceKey((null===(a=t.payload)||void 0===a?void 0:a.result)||[]);return d.a.createElement(Q.a,{container:!0,spacing:0},d.a.createElement(Q.a,{item:!0,xs:6},d.a.createElement(M.a,{component:"span",variant:"caption",color:"textSecondary"},"log type:")),d.a.createElement(Q.a,{item:!0,xs:6},d.a.createElement(M.a,{component:"span",variant:"overline",color:"secondary"},t.type)),Object.keys(n).map((function(e){return d.a.createElement(d.a.Fragment,{key:e},d.a.createElement(Q.a,{item:!0,xs:3},d.a.createElement(M.a,{component:"span",variant:"caption",color:"textSecondary"},e)),d.a.createElement(Q.a,{item:!0,xs:9},d.a.createElement(M.a,{component:"span",variant:"body1",color:"secondary"},n[e]&&n[e].join(", "))))})))})));var ae=d.a.memo(Object(_.a)((function(e){return Object(G.a)({})}))((function(e){var a=e.log;return d.a.createElement(d.a.Fragment,null,d.a.createElement(Q.a,{container:!0,spacing:0},d.a.createElement(Q.a,{item:!0,xs:6},d.a.createElement(M.a,{component:"span",variant:"caption",color:"textSecondary"},"log type:")),d.a.createElement(Q.a,{item:!0,xs:6},d.a.createElement(M.a,{component:"span",variant:"overline",color:"secondary"},a.type))))})));var te=d.a.memo(Object(_.a)((function(e){return Object(G.a)({root:{width:"100%",backgroundColor:e.palette.background.paper,overflowY:"scroll"}})}))((function(e){var a=e.profiles,t=e.logs,n=e.classes;return d.a.createElement(V.a,{className:n.root},t&&t.length?Object(m.a)(t).reverse().map((function(e,t){return d.a.createElement(d.a.Fragment,{key:e.timestamp},!!t&&d.a.createElement(W.a,{variant:"inset",component:"li",light:!0}),d.a.createElement(Z,{profile:a[e.authorUid],log:e},e.type===Y.a.DICE_ROLL&&e.payload&&d.a.createElement(ee,{log:e}),e.type===Y.a.NEW_PLAYER&&d.a.createElement(ae,{log:e})))})):"")}))),ne=t(680),re=t(658),ce=t(660),oe=t(350),ie=t.n(oe);var le=d.a.memo((function(e){var a=e.logs,t=e.profile;return d.a.createElement(ne.a,{elevation:0},d.a.createElement(re.a,{expandIcon:d.a.createElement(ie.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},d.a.createElement(Q.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"center",spacing:2},d.a.createElement(Q.a,{item:!0},d.a.createElement(q.a,{src:t.characterAvatarUrl||t.avatarUrl||t.photoURL,alt:t.displayName})),d.a.createElement(Q.a,{item:!0},d.a.createElement(M.a,null,t.characterName||t.displayName)))),d.a.createElement(ce.a,null,d.a.createElement("article",null,function(e){return Object(m.a)(e).reverse().map((function(e,a){return d.a.createElement("ul",{key:e.timestamp},!!a&&d.a.createElement(W.a,{component:"div",light:!0}),e.type===Y.a.DICE_ROLL&&e.payload&&d.a.createElement(ee,{log:e}),e.type===Y.a.NEW_PLAYER&&d.a.createElement(ae,{log:e}))}))}(a))))}));var se=d.a.memo(Object(_.a)((function(e){return Object(G.a)({root:{width:"100%",backgroundColor:e.palette.background.paper,overflowY:"scroll"}})}))((function(e){var a=e.profiles,t=e.logs,n=e.classes;return d.a.createElement(V.a,{className:n.root},d.a.createElement(d.a.Fragment,null,Object.keys(a).map((function(e){return d.a.createElement(le,{key:e,profile:a[e],logs:t.filter((function(a){return a.authorUid===e}))})}))))})));var me=Object(_.a)((function(e){return Object(G.a)({root:{backgroundColor:e.palette.background.paper,width:"100%",height:"100%",position:"relative",zIndex:10,overflow:"hidden"},bar:{borderBottom:"1px solid rgba(0, 0, 0, 0.12)"},tab:{overflowX:"hidden",height:"calc(100% - ".concat(e.spacing(6),"px)"),overflowY:"scroll"},tabContent:{margin:e.spacing(-2)}})}))((function(e){var a=e.classes,t=e.visible,n=void 0===t||t,r=Object(A.a)(),c=d.a.useState(0),o=Object(U.a)(c,2),i=o[0],l=o[1],s=Object(p.useSelector)(v.a.usersProfiles),m=Object(p.useSelector)(v.a.selectedRoomLogs);return d.a.createElement(k.a,{direction:"right",in:n},d.a.createElement(L.a,{className:a.root,elevation:2},d.a.createElement(D.a,{className:a.bar,position:"static",color:"default",elevation:0},d.a.createElement(H.a,{value:i,onChange:function(e,a){l(a)},indicatorColor:"secondary",textColor:"primary",variant:"fullWidth","aria-label":"full width tabs example"},d.a.createElement(z.a,Object.assign({label:"Logs Timeline"},de(0))),d.a.createElement(z.a,Object.assign({label:"Players Logs"},de(1))))),d.a.createElement("div",{className:a.tab},d.a.createElement(T.a,{axis:"rtl"===r.direction?"x-reverse":"x",index:i,onChangeIndex:function(e){l(e)}},d.a.createElement(ue,{value:i,index:0,dir:r.direction},d.a.createElement("div",{className:a.tabContent},d.a.createElement(te,{profiles:s,logs:m}))),d.a.createElement(ue,{value:i,index:1,dir:r.direction},d.a.createElement("div",{className:a.tabContent},d.a.createElement(se,{profiles:s,logs:m})))))))}));function ue(e){var a=e.children,t=e.value,n=e.index,r=Object(I.a)(e,["children","value","index"]);return d.a.createElement(M.a,Object.assign({component:"div",role:"tabpanel",hidden:t!==n,id:"full-width-tabpanel-".concat(n),"aria-labelledby":"full-width-tab-".concat(n)},r),t===n&&d.a.createElement(F.a,{p:3},a))}function de(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var pe=d.a.memo((function(e){var a=e.visible,t=void 0===a||a;return d.a.createElement(k.a,{direction:"left",in:t},d.a.createElement("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",zIndex:10}},d.a.createElement(me,null)))})),be=t(276),ge=t(647),Ee=t(768),fe=t(744),ve=t.n(fe),he=t(746),Oe=t.n(he),ye=t(745),je=t.n(ye),xe=t(766),Se=t(767),Re=t(783),we=t(595);var Ce=d.a.memo(Object(_.a)((function(e){return Object(G.a)({tile:{borderRadius:e.spacing(1),marginRight:e.spacing(2),maxWidth:e.spacing(30),overflow:"hidden",padding:"0 !Important",width:"100%"},title:{color:e.palette.primary.light},titleDisable:{color:e.palette.warning.light},masterGame:{position:"absolute",zIndex:10,top:0,right:0},titleBar:{background:"linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0) 100%)"}})}))((function(e){var a=e.classes,t=e.player,n=e.gameMaster;return d.a.createElement(xe.a,{className:a.tile},d.a.createElement("img",{src:t.avatarUrl||t.photoURL,alt:t.displayName}),d.a.createElement(Se.a,{title:t.displayName,classes:{root:a.titleBar,title:t.connected?a.title:a.titleDisable},actionIcon:d.a.createElement(Re.a,{title:t.connected?"Online":"Offline"},d.a.createElement(we.a,{"aria-label":"star ".concat(t.displayName)},t.connected?d.a.createElement(ve.a,{className:a.title}):d.a.createElement(je.a,{className:a.titleDisable})))}),n&&d.a.createElement(Re.a,{className:Object(S.a)(a.masterGame,t.connected?a.title:a.titleDisable),title:"Game Master"},d.a.createElement(we.a,{"aria-label":"star ".concat(t.displayName)},d.a.createElement(Oe.a,null))))})));var Ne=Object(_.a)((function(e){return Object(G.a)({root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden",backgroundColor:e.palette.background.paper},gridList:{height:e.spacing(20),width:"100%",flexWrap:"nowrap",transform:"translateZ(0)"}})}))((function(e){var a,t=e.classes,n=e.visible,r=Object(p.useSelector)(v.a.selectedRoomPlayers),c=Object(p.useSelector)(v.a.selectedRoomGameMasterProfile),o=Object(p.useSelector)(v.a.usersProfiles);return d.a.createElement(k.a,{direction:"up",in:n},d.a.createElement(Ee.a,{className:t.gridList,cols:2.5},c&&d.a.createElement(ge.a,{in:!0,timeout:300},d.a.createElement(Ce,{player:Object(s.a)({},c,{connected:null===(a=o[c.uid])||void 0===a?void 0:a.connected}),gameMaster:!0})),r&&Object.keys(r).map((function(e,a){var t,n=Object(s.a)({},r[e],{connected:null===(t=o[e])||void 0===t?void 0:t.connected});return d.a.createElement(ge.a,{in:!0,key:e,timeout:1e3*a+1300},d.a.createElement(Ce,{player:n}))}))))})),ke=t(747),Ie=t.n(ke),Ue=t(750),De=t.n(Ue),Le=t(751),Pe=t.n(Le),Te=t(748),Ae=t.n(Te),He=t(749),ze=t.n(He),Me=t(752),Fe=t.n(Me),Ge=t(780),_e=t(782),We=t(784),Ve=t(770),Ye=t(785);var Be=d.a.memo(Object(_.a)((function(e){return Object(G.a)({})}))((function(e){var a=e.direction,t=void 0===a?"left":a,n=e.actions,r=d.a.useState(!1),c=Object(U.a)(r,2),o=c[0],i=c[1],l=function(){return i(!1)};return d.a.createElement(We.a,{ariaLabel:"SpeedDial example",icon:d.a.createElement(Ye.a,null),onClose:l,onOpen:function(){return i(!0)},open:o,direction:t},n.map((function(e){return d.a.createElement(Ve.a,{key:e.name,icon:e.icon,tooltipTitle:e.name,onClick:function(){return e.callback?e.callback(l):l()}})})))}))),Je=t(691);function qe(e){var a=e.open,t=e.onClose,n=Object(b.useFirestore)(),r=Object(p.useSelector)(v.a.selectedRoomFormData),c=Object(p.useSelector)(j.a.selectedRoomUid);return d.a.createElement(Je.a,{open:a,onClose:t,onSubmit:function(e){Object.keys(e).forEach((function(a){return void 0===e[a]&&delete e[a]})),n.doc("".concat(f.a.ROOMS,"/").concat(c)).update(Object(s.a)({},e)).then((function(e){t()})).catch((function(e){console.log({e:e})}))},initialValues:r})}var Ke=Object(_.a)((function(e){return Object(G.a)({snackbar:{top:e.spacing(8)}})}))((function(e){var a=e.classes,t=Object(p.useDispatch)(),n=Object(p.useSelector)(be.a.isGameMasterOfSelectedRoom),r=Object(p.useSelector)(j.a.drawerOpened),c=Object(p.useSelector)(j.a.chatOpened),o=Object(p.useSelector)(j.a.playersOpened),i=Object(u.useState)(!1),l=Object(U.a)(i,2),m=l[0],b=l[1],g=d.a.useState({type:"success",open:!1,text:""}),E=Object(U.a)(g,2),f=E[0],v=E[1],h=n?[{icon:d.a.createElement(Ie.a,null),name:"Edit Room Description",callback:function(e){return b(!0)}}]:[],O=[{icon:r?d.a.createElement(Ae.a,null):d.a.createElement(ze.a,null),name:r?"Hide Nav":"Show Nav",callback:function(e){return t(y.a.setDrawerOpenValue(!r))}},{icon:d.a.createElement(De.a,null),name:c?"Hide chat":"Show Chat",callback:function(e){return t(y.a.setChatOpenValue(!c))}},{icon:d.a.createElement(Pe.a,null),name:o?"Hide players":"Show players",callback:function(e){return t(y.a.setPlayersOpenValue(!o))}},{icon:d.a.createElement(Fe.a,null),name:"Copy Room Url",callback:function(e){navigator.permissions.query({name:"clipboard-write"}).then((function(e){"granted"!==e.state&&"prompt"!==e.state||navigator.clipboard.writeText(window.location.href).then((function(){return v({type:"success",open:!0,text:"Room URL copied to clipboard!"})}),(function(){return v({type:"error",open:!0,text:"Upss.. there was an error"})}))}))}}].concat(h);return d.a.createElement(d.a.Fragment,null,d.a.createElement(Be,{actions:O,direction:"right"}),d.a.createElement(_e.a,{className:a.snackbar,anchorOrigin:{vertical:"top",horizontal:"right"},open:f.open,autoHideDuration:6e3,onClose:function(){return v(Object(s.a)({},f,{open:!1}))}},d.a.createElement(Ge.a,{onClose:function(){return v(Object(s.a)({},f,{open:!1}))},severity:f.type},f.text)),d.a.createElement(qe,{open:m,onClose:function(){return b(!1)}}))})),Qe=Object(R.a)((function(e){return{root:{position:"relative",margin:e.spacing(-6,-4),height:"calc(100vh - ".concat(e.spacing(10),"px)"),padding:e.spacing(1,1,0,1)},mainGrid:{display:"grid",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto auto",columnGap:e.spacing(2)+"px",rowGap:e.spacing(2)+"px",width:"100%",height:"100%"},gridItemLogs:{position:"relative",gridColumn:"2",gridRow:"1"},gridItemChatter:{position:"relative",gridColumn:"2",gridRow:"2 / span 2"},gridItemDiceCard:{position:"relative",gridColumn:"1 / span 2",gridRow:"1 / span 2"},gridItemPlayers:{position:"relative",gridColumn:"1",gridRow:"3"},speedDial:{position:"absolute",bottom:e.spacing(1),left:e.spacing(1),zIndex:10},diceDashboard:{position:"absolute",zIndex:1e3,top:e.spacing(1),left:e.spacing(1)},maxHeight:{maxHeight:"3000px",transition:"max-height 225ms cubic-bezier(0, 0, 0.2, 1) 0ms"},noHeight:{maxHeight:0}}}));function Xe(){var e=Qe(),a=Object(p.useSelector)(j.a.playersOpened),t=Object(p.useSelector)(j.a.chatOpened),n=Object(p.useSelector)(j.a.diceRolling),r=Object(p.useSelector)(v.a.selectedRoom),c=Object(p.useSelector)(be.a.isUserARoomPlayerOrGameMaster),o=!a||!r;return d.a.createElement("section",{className:e.root},d.a.createElement("div",{className:e.mainGrid},d.a.createElement("div",{className:e.gridItemLogs},d.a.createElement(pe,{visible:!n&&!!r})),d.a.createElement("div",{className:e.gridItemDiceCard},d.a.createElement(C.a,null),d.a.createElement("nav",{className:e.diceDashboard},d.a.createElement(N.a,{visible:!n&&!!r&&c,room:r})),d.a.createElement("nav",{className:e.speedDial},d.a.createElement(Ke,null))),d.a.createElement("div",{className:e.gridItemChatter},d.a.createElement(w.a,{visible:t&&!n&&c})),d.a.createElement("div",{className:e.gridItemPlayers},d.a.createElement("div",{className:Object(S.a)(e.maxHeight,o&&e.noHeight)},d.a.createElement(Ne,{visible:!o})))))}a.default=i((function(e){var a=e.match,t=Object(p.useDispatch)(),n=Object(b.useFirestore)(),r=Object(p.useSelector)(v.a.selectedRoom),c=Object(p.useSelector)(j.a.selectedRoomUid),o=Object(p.useSelector)(O.a.match),i=Object(p.useSelector)(E.a.userProfile);return Object(u.useEffect)((function(){return JSON.stringify(a)!==JSON.stringify(o)&&t(h.a.matchChange(a)),void t(y.a.setSelectedRoom(o.params.roomId))})),Object(u.useEffect)((function(){!function(){if(r&&!((null===r||void 0===r?void 0:r.maxPlayers)<=Object.keys(r.players).length)&&(null===r||void 0===r?void 0:r.players)&&i.uid&&r.gameMaster.uid!==i.uid&&!r.players[i.uid]){var e=n.doc("".concat(f.a.ROOMS,"/").concat(c));n.runTransaction((function(a){return a.get(e).then((function(t){var n={authorUid:i.uid,timestamp:Date.now(),type:Y.a.NEW_PLAYER},r=[].concat(Object(m.a)(t.data().logs),[n]),c={displayName:i.displayName,email:i.email,photoURL:i.photoURL,uid:i.uid},o=Object(s.a)({},t.data().players,Object(l.a)({},i.uid,c)),u=[].concat(Object(m.a)(t.data().playersUid),[i.uid]);return a.update(e,{logs:r,players:o,playersUid:u})})).catch((function(e){console.log("Transaction failure:",e)}))}))}}()}),[c,null===r||void 0===r?void 0:r.createdAt,i.uid]),Object(u.useEffect)((function(){return function(){t(y.a.setSelectedRoom(null))}}),[]),Object(u.useEffect)((function(){t(g.a.setSelectedChat((null===r||void 0===r?void 0:r.chatUid)||null))}),[null===r||void 0===r?void 0:r.chatUid]),d.a.createElement(d.a.Fragment,null,c&&[c].map((function(e){return d.a.createElement(x.b,{key:e},d.a.createElement(Xe,null))})))}))}}]);
//# sourceMappingURL=7.5d15a9cb.chunk.js.map